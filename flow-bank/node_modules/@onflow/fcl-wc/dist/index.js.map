{"version":3,"file":"index.js","sources":["../src/constants.ts","../src/utils.ts","../src/session.ts","../src/ui/components/Notification.tsx","../src/ui/notifications.tsx","../src/ui/assets/mobile.svg","../src/store.ts","../src/service.ts","../src/fcl-wc.ts"],"sourcesContent":["export enum FLOW_METHODS {\n  FLOW_AUTHN = \"flow_authn\",\n  FLOW_PRE_AUTHZ = \"flow_pre_authz\",\n  FLOW_AUTHZ = \"flow_authz\",\n  FLOW_USER_SIGN = \"flow_user_sign\",\n}\n\nexport enum REQUEST_TYPES {\n  SESSION_REQUEST = \"session_proposal\",\n  SIGNING_REQUEST = \"signing_request\",\n}\n\nexport const SERVICE_PLUGIN_NAME = \"fcl-plugin-service-walletconnect\"\nexport const WC_SERVICE_METHOD = \"WC/RPC\"\n","import {log, LEVELS} from \"@onflow/util-logger\"\nimport * as fclCore from \"@onflow/fcl-core\"\nimport {FLOW_METHODS, WC_SERVICE_METHOD} from \"./constants\"\nimport {Service} from \"@onflow/typedefs\"\n\nconst PRE_AUTHZ_SERVICE_TYPE = \"pre-authz\"\n\nconst makeFlowServicesFromWallets = (wallets: any[]) => {\n  return Object.values(wallets)\n    .filter(w => w.app_type === \"wallet\")\n    .map(wallet => {\n      return {\n        f_type: \"Service\",\n        f_vsn: \"1.0.0\",\n        type: \"authn\",\n        method: \"WC/RPC\",\n        uid: wallet.mobile?.universal,\n        endpoint: \"flow_authn\",\n        optIn: true,\n        provider: {\n          address: null,\n          name: wallet.name,\n          icon: wallet.image_url?.sm,\n          description: wallet.description,\n          website: wallet.homepage,\n          color: wallet.metadata?.colors?.primary,\n          supportEmail: null,\n        },\n      }\n    })\n}\n\nexport const fetchFlowWallets = async (projectId: string) => {\n  try {\n    const network = await fclCore.getChainId()\n    const wcApiWallets = await fetch(\n      `https://explorer-api.walletconnect.com/v3/wallets?projectId=${projectId}&chains=flow:${network}&entries=5&page=1`\n    ).then(res => res.json())\n\n    if (wcApiWallets?.count > 0) {\n      return makeFlowServicesFromWallets(wcApiWallets.listings)\n    }\n\n    return []\n  } catch (error) {\n    if (error instanceof Error) {\n      log({\n        title: `${error.name} Error fetching wallets from WalletConnect API`,\n        message: error.message,\n        level: LEVELS.error,\n      })\n    }\n  }\n}\n\nexport function isAndroid() {\n  return (\n    typeof navigator !== \"undefined\" && /android/i.test(navigator.userAgent)\n  )\n}\n\nexport function isSmallIOS() {\n  return (\n    typeof navigator !== \"undefined\" && /iPhone|iPod/.test(navigator.userAgent)\n  )\n}\n\nexport function isLargeIOS() {\n  return typeof navigator !== \"undefined\" && /iPad/.test(navigator.userAgent)\n}\n\nexport function isIOS() {\n  return isSmallIOS() || isLargeIOS()\n}\n\nexport function isMobile() {\n  return isAndroid() || isIOS()\n}\n\nexport function openDeeplink(url: string) {\n  if (url.startsWith(\"http\")) {\n    // Workaround for https://github.com/rainbow-me/rainbowkit/issues/524.\n    // Using 'window.open' causes issues on iOS in non-Safari browsers and\n    // WebViews where a blank tab is left behind after connecting.\n    // This is especially bad in some WebView scenarios (e.g. following a\n    // link from Twitter) where the user doesn't have any mechanism for\n    // closing the blank tab.\n    // For whatever reason, links with a target of \"_blank\" don't suffer\n    // from this problem, and programmatically clicking a detached link\n    // element with the same attributes also avoids the issue.\n    const link = document.createElement(\"a\")\n    link.href = url\n    link.target = \"_blank\"\n    link.rel = \"noreferrer noopener\"\n    link.click()\n  } else {\n    window.open(url, \"_blank\")\n  }\n}\n\nexport function shouldDeepLink({service, user}: {service: Service; user: any}) {\n  // Only deeplink on mobile\n  if (!isMobile()) return false\n\n  // If this is an authn request, the user has already been deeplinked by connectWc\n  if (service.endpoint === FLOW_METHODS.FLOW_AUTHN) return false\n\n  // If there was a pre-authz WC request, the user has already been deeplinked\n  if (\n    service.endpoint === FLOW_METHODS.FLOW_AUTHZ &&\n    user?.services?.find(\n      (s: Service) =>\n        s.method === WC_SERVICE_METHOD && s.type === PRE_AUTHZ_SERVICE_TYPE\n    )\n  )\n    return false\n\n  return true\n}\n\nexport function preloadImage(url?: string | null) {\n  if (!url) return\n  const img = new Image()\n  img.src = url\n}\n","import * as fclCore from \"@onflow/fcl-core\"\nimport {FLOW_METHODS} from \"./constants\"\nimport {PairingTypes, SessionTypes} from \"@walletconnect/types\"\nimport {UniversalProvider} from \"@walletconnect/universal-provider\"\nimport {Service} from \"@onflow/typedefs\"\n\n// Create a new session proposal with the WalletConnect client\nexport async function createSessionProposal({\n  provider,\n  existingPairing,\n  network,\n}: {\n  provider: InstanceType<typeof UniversalProvider>\n  existingPairing?: PairingTypes.Struct\n  network?: string\n}) {\n  const _network = network || (await fclCore.getChainId())\n\n  const requiredNamespaces = {\n    flow: {\n      methods: [\n        FLOW_METHODS.FLOW_AUTHN,\n        FLOW_METHODS.FLOW_PRE_AUTHZ,\n        FLOW_METHODS.FLOW_AUTHZ,\n        FLOW_METHODS.FLOW_USER_SIGN,\n      ],\n      chains: [`flow:${_network}`],\n      events: [\"chainChanged\", \"accountsChanged\"],\n    },\n  }\n\n  let cleanup: () => void\n  const uri = new Promise<string>((resolve, reject) => {\n    const onDisplayUri = (uri: string) => {\n      resolve(uri)\n    }\n    provider.on(\"display_uri\", onDisplayUri)\n    cleanup = () => {\n      provider.removeListener(\"display_uri\", onDisplayUri)\n      reject(new Error(\"WalletConnect Session Request aborted\"))\n    }\n  })\n\n  const sessionPromise = provider\n    .connect({\n      pairingTopic: existingPairing?.topic,\n      namespaces: requiredNamespaces,\n    })\n    .finally(() => {\n      cleanup()\n    })\n\n  return {\n    uri: await uri,\n    approval: () => sessionPromise,\n  }\n}\n\nexport const request = async ({\n  method,\n  body,\n  session,\n  provider,\n  isExternal,\n  abortSignal,\n  disableNotifications,\n}: {\n  method: any\n  body: any\n  session: SessionTypes.Struct\n  provider: InstanceType<typeof UniversalProvider>\n  isExternal?: boolean\n  abortSignal?: AbortSignal\n  disableNotifications?: boolean\n}) => {\n  const [chainId, addr, address] = makeSessionData(session)\n  const data = JSON.stringify({...body, addr, address})\n\n  const result: any = await Promise.race([\n    provider.client.request({\n      request: {\n        method,\n        params: [data],\n      },\n      chainId,\n      topic: provider.session?.topic!,\n    }),\n    new Promise((_, reject) => {\n      if (abortSignal?.aborted) {\n        reject(new Error(\"WalletConnect Request aborted\"))\n      }\n      abortSignal?.addEventListener(\"abort\", () => {\n        reject(new Error(\"WalletConnect Request aborted\"))\n      })\n    }),\n  ])\n\n  if (typeof result !== \"object\" || result == null) return\n\n  switch (result.status) {\n    case \"APPROVED\":\n      function addSessionInfo(service: Service) {\n        if (service.method === \"WC/RPC\") {\n          return {\n            ...service,\n            params: {\n              ...service.params,\n              ...(isExternal ? {externalProvider: session.topic} : {}),\n              ...(disableNotifications ? {disableNotifications} : {}),\n            },\n          }\n        }\n        return service\n      }\n\n      if (method === FLOW_METHODS.FLOW_AUTHN) {\n        const services = (result?.data?.services ?? []).map(addSessionInfo)\n\n        return {\n          ...(result.data ? result.data : {}),\n          services,\n        }\n      }\n\n      if (method === FLOW_METHODS.FLOW_PRE_AUTHZ) {\n        return {\n          ...result.data,\n          ...(result.data?.proposer\n            ? {proposer: addSessionInfo(result.data.proposer)}\n            : {}),\n          payer: [...result.data?.payer?.map(addSessionInfo)],\n          authorization: [...result.data?.authorization?.map(addSessionInfo)],\n        }\n      }\n\n      return result.data\n\n    case \"DECLINED\":\n      throw new Error(`Declined: ${result.reason || \"No reason supplied\"}`)\n\n    case \"REDIRECT\":\n      return result.data\n\n    default:\n      throw new Error(`Declined: No reason supplied`)\n  }\n}\n\nexport function makeSessionData(session: SessionTypes.Struct) {\n  const [namespace, reference, address] = Object.values<any>(session.namespaces)\n    .map(namespace => namespace.accounts)\n    .flat()\n    .filter(account => account.startsWith(\"flow:\"))[0]\n    .split(\":\")\n\n  const chainId = `${namespace}:${reference}`\n  const addr = address\n  return [chainId, addr, address]\n}\n","import {NotificationInfo} from \"../../types/types\"\nimport {isMobile} from \"../../utils\"\n\nexport function Notification({\n  title,\n  message,\n  icon,\n  onClick,\n  onDismiss,\n  animate,\n}: NotificationInfo & {animate?: boolean}) {\n  return (\n    <div\n      className={`fixed bottom-3 left-3 right-3 mx-auto z-[2147483647] flex max-w-sm\n        overflow-hidden rounded-lg border border-gray-200 bg-white p-4 shadow-lg\n        md:bottom-4 md:left-auto md:right-4 dark:bg-gray-700 dark:border-gray-600\n        ${animate ? \"animate-slideUp\" : \"\"}`}\n      role=\"alert\"\n      onClick={e => {\n        if (onClick) {\n          e.stopPropagation()\n          onClick?.()\n        }\n      }}\n    >\n      {icon && (\n        <img\n          className=\"h-10 w-10 self-center rounded-md md:self-start\"\n          src={icon}\n          alt={title}\n        />\n      )}\n      <div className=\"ml-3 grow\">\n        <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n          {title}\n        </p>\n        <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-300\">\n          {message}\n        </p>\n      </div>\n\n      <button\n        className={`ml-2 inline-flex rounded-full text-gray-400 hover:text-gray-500 focus:ring-0\n          dark:text-gray-200 dark:hover:text-gray-300 ${\n          isMobile()\n              ? \"self-center p-2\"\n              : \"self-start p-0 bg-transparent border-transparent focus:border-transparent\"\n          }`}\n        onClick={e => {\n          e.stopPropagation()\n          onDismiss?.()\n        }}\n      >\n        <span className=\"sr-only\">Close</span>\n        <svg\n          className={\"h-5 w-5\"}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 20 20\"\n          fill=\"currentColor\"\n          aria-hidden=\"true\"\n        >\n          <path\n            fillRule=\"evenodd\"\n            d=\"M14.354 5.646a.5.5 0 00-.708 0L10 9.293 5.354 4.646a.5.5 0 00-.708.708L9.293 10l-4.647 4.646a.5.5 0 00.708.708L10 10.707l4.646 4.647a.5.5 0 00.708-.708L10.707 10l4.647-4.646a.5.5 0 000-.708z\"\n          />\n        </svg>\n      </button>\n    </div>\n  )\n}\n","import {render} from \"preact\"\nimport styles from \"./styles.css\"\nimport {Notification} from \"./components/Notification\"\nimport {NotificationInfo} from \"../types/types\"\n\nlet renderRoot: HTMLElement | null = null\nlet id = 0\nlet dismissTimeout: NodeJS.Timeout | null = null\n\nfunction createRenderRoot() {\n  const shadowHost = document.createElement(\"div\")\n  const shadowRoot = shadowHost.attachShadow({mode: \"open\"})\n  const container = document.createElement(\"div\")\n\n  shadowRoot.appendChild(container)\n  document.body.appendChild(shadowHost)\n\n  const style = document.createElement(\"style\")\n  style.textContent = styles\n  shadowRoot.appendChild(style)\n\n  // Subscribe to root dark mode changes to inherit the theme\n  const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\")\n  const listener = () => {\n    container.classList.toggle(\"dark\", mediaQuery.matches)\n  }\n  mediaQuery.addEventListener(\"change\", listener)\n  listener()\n\n  return container\n}\n\n/**\n * Show a notification to the user.  Only one notification can be shown at a time and will replace any existing notification.\n */\nexport function showNotification({\n  title,\n  message,\n  icon,\n  onClick,\n  onDismiss,\n  debounceDelay = 0,\n}: NotificationInfo & {debounceDelay?: number}): {dismiss: () => void} {\n  if (!renderRoot) {\n    renderRoot = createRenderRoot()\n  }\n\n  // Don't animate if we are replacing an existing notification\n  const animate = !dismissTimeout\n  if (dismissTimeout) {\n    clearTimeout(dismissTimeout)\n    dismissTimeout = null\n  }\n\n  render(\n    <Notification\n      key={id++}\n      title={title}\n      message={message}\n      icon={icon}\n      onClick={onClick}\n      onDismiss={() => {\n        onDismiss?.()\n        dismissUi()\n      }}\n      animate={animate}\n    />,\n    renderRoot\n  )\n\n  function dismissUi() {\n    if (renderRoot) {\n      render(null, renderRoot)\n    }\n  }\n\n  return {\n    dismiss: () => {\n      // We need to delay the dismiss to debounce any subsequent notifications\n      // This is important when there is both a FCL/WC authz and pre-authz service\n      dismissTimeout = setTimeout(() => {\n        dismissTimeout = null\n        dismissUi()\n      }, debounceDelay)\n    },\n  }\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3e%3c!--!Font Awesome Free 6.7.1 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons%2c Inc.--%3e%3cpath d='M16 64C16 28.7 44.7 0 80 0L304 0c35.3 0 64 28.7 64 64l0 384c0 35.3-28.7 64-64 64L80 512c-35.3 0-64-28.7-64-64L16 64zM224 448a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM304 64L80 64l0 320 224 0 0-320z'/%3e%3c/svg%3e\";\n  export default img;","export function createStore<T>(initialState: T) {\n  const subscribers = new Set<(state: T) => void>()\n  let state = initialState\n\n  const subscribe = (subscriber: (state: T) => void) => {\n    subscribers.add(subscriber)\n    return () => {\n      subscribers.delete(subscriber)\n    }\n  }\n\n  const setState = (newState: T) => {\n    state = newState\n    subscribers.forEach(subscriber => subscriber(state))\n  }\n\n  const getState = () => state\n\n  return {\n    subscribe,\n    setState,\n    getState,\n  }\n}\n","import {invariant} from \"@onflow/util-invariant\"\nimport {log, LEVELS} from \"@onflow/util-logger\"\nimport {isMobile, openDeeplink, preloadImage, shouldDeepLink} from \"./utils\"\nimport {\n  FLOW_METHODS,\n  REQUEST_TYPES,\n  SERVICE_PLUGIN_NAME,\n  WC_SERVICE_METHOD,\n} from \"./constants\"\nimport {createSessionProposal, request} from \"./session\"\nimport {showNotification} from \"./ui/notifications\"\nimport type {FclWalletConnectConfig} from \"./fcl-wc\"\nimport mobileIcon from \"./ui/assets/mobile.svg\"\nimport {CurrentUser, Service} from \"@onflow/typedefs\"\nimport {SessionTypes} from \"@walletconnect/types\"\nimport {UniversalProvider} from \"@walletconnect/universal-provider\"\nimport {createStore} from \"./store\"\n\ntype WalletConnectModalType = import(\"@walletconnect/modal\").WalletConnectModal\n\ntype Constructor<T> = new (...args: any[]) => T\n\nlet providerStore = createStore<{\n  [key: string]: InstanceType<typeof UniversalProvider>\n}>({})\n\nexport const makeServicePlugin = (\n  provider: Promise<InstanceType<typeof UniversalProvider> | null>,\n  config: FclWalletConnectConfig = {\n    projectId: \"\",\n    includeBaseWC: false,\n    wallets: [],\n    wcRequestHook: null,\n    pairingModalOverride: null,\n    disableNotifications: false,\n  }\n) => ({\n  name: SERVICE_PLUGIN_NAME,\n  f_type: \"ServicePlugin\",\n  type: \"discovery-service\",\n  serviceStrategy: {\n    method: WC_SERVICE_METHOD,\n    exec: makeExec(\n      provider,\n      config,\n      import(\"@walletconnect/modal\").then(m => m.WalletConnectModal)\n    ),\n  },\n  services: [],\n})\n\nconst makeExec = (\n  signerPromise: Promise<InstanceType<typeof UniversalProvider> | null>,\n  config: FclWalletConnectConfig,\n  WalletConnectModal: Promise<Constructor<WalletConnectModalType>>\n) => {\n  return async ({\n    service,\n    body,\n    opts,\n    abortSignal,\n    user,\n    config,\n  }: {\n    service: any\n    body: any\n    opts: any\n    abortSignal?: AbortSignal\n    user: any\n    config: any\n  }) => {\n    // Preload provider image\n    preloadImage(service.provider?.icon)\n\n    const {\n      wcRequestHook,\n      pairingModalOverride,\n      disableNotifications: _appDisabledNotifications,\n    } = config\n\n    const appDisabledNotifications =\n      service.params?.disableNotifications ?? _appDisabledNotifications\n\n    const resolvedProvider = await resolveProvider({\n      provider: signerPromise,\n      externalProviderOrTopic: service.params?.externalProvider,\n    })\n    invariant(!!resolvedProvider, \"WalletConnect is not initialized\")\n\n    const {provider: provider, isExternal} = resolvedProvider\n\n    let session: SessionTypes.Struct | null = provider.session ?? null,\n      pairing: any\n    const method = service.endpoint\n    const appLink = validateAppLink(service)\n\n    // If the user is already connected to this session, use it\n    if (\n      !!session?.topic &&\n      session?.topic === service.params?.externalProvider &&\n      method === FLOW_METHODS.FLOW_AUTHN\n    ) {\n      return user\n    }\n\n    if (session == null) {\n      session = await new Promise<SessionTypes.Struct>((resolve, reject) => {\n        function onClose() {\n          reject(`Declined: Externally Halted`)\n        }\n\n        connectWc(WalletConnectModal)({\n          service,\n          onClose,\n          appLink,\n          provider,\n          method,\n          pairing,\n          wcRequestHook,\n          pairingModalOverride,\n          abortSignal,\n          network: config.client.network,\n        }).then(resolve, reject)\n      })\n    }\n\n    if (wcRequestHook && wcRequestHook instanceof Function) {\n      wcRequestHook({\n        type: REQUEST_TYPES.SIGNING_REQUEST,\n        method,\n        service,\n        session: session ?? null,\n        pairing: pairing ?? null,\n        uri: null,\n      })\n    }\n\n    // Deeplink to the wallet app if necessary\n    if (shouldDeepLink({service, user})) {\n      openDeeplink(appLink)\n    }\n\n    // Show notification to the user if not disabled by app developer or wallet\n    const walletDisabledNotifications =\n      session?.sessionProperties?.[\"fclWc.disableNotificationsOnMobile\"] ===\n      \"true\"\n\n    const notification =\n      !appDisabledNotifications && !walletDisabledNotifications\n        ? showWcRequestNotification({\n            user,\n            service,\n          })\n        : null\n\n    // Make request to the WalletConnect client and return the result\n    return await request({\n      method,\n      body,\n      session,\n      provider,\n      abortSignal,\n      isExternal,\n      disableNotifications: service.params?.disableNotifications,\n    }).finally(() => notification?.dismiss())\n\n    function validateAppLink({uid}: {uid: string}) {\n      if (!(uid && /^(ftp|http|https):\\/\\/[^ \"]+$/.test(uid))) {\n        log({\n          title: \"WalletConnect Service Warning\",\n          message: `service.uid should be a valid universal link url. Found: ${uid}`,\n          level: LEVELS.warn,\n        })\n      }\n      return uid\n    }\n  }\n}\n\n// Connect to WalletConnect directly from the browser via deep link or WalletConnectModal\nfunction connectWc(\n  WalletConnectModal: Promise<Constructor<WalletConnectModalType>>\n) {\n  return async ({\n    service,\n    onClose,\n    appLink,\n    provider,\n    method,\n    pairing,\n    wcRequestHook,\n    pairingModalOverride,\n    abortSignal,\n    network,\n  }: {\n    service: any\n    onClose: any\n    appLink: string\n    provider: InstanceType<typeof UniversalProvider>\n    method: string\n    pairing: any\n    wcRequestHook: any\n    pairingModalOverride: any\n    abortSignal?: AbortSignal\n    network: string\n  }): Promise<SessionTypes.Struct> => {\n    const projectId = provider.providerOpts.projectId\n    invariant(\n      !!projectId,\n      \"Cannot establish connection, WalletConnect projectId is undefined\"\n    )\n\n    let _uri: string | null = null,\n      walletConnectModal: WalletConnectModalType | null = null\n\n    try {\n      const {uri, approval} = await createSessionProposal({\n        provider,\n        existingPairing: pairing,\n        network,\n      })\n\n      if (wcRequestHook && wcRequestHook instanceof Function) {\n        wcRequestHook({\n          type: REQUEST_TYPES.SESSION_REQUEST,\n          method,\n          service,\n          session: null,\n          pairing: pairing ?? null,\n          uri: uri ?? null,\n        })\n      }\n\n      if (isMobile()) {\n        const queryString = new URLSearchParams({uri: uri}).toString()\n        let url = pairing == null ? appLink + \"?\" + queryString : appLink\n        openDeeplink(url)\n      } else if (!pairing) {\n        if (!pairingModalOverride) {\n          walletConnectModal = new (await WalletConnectModal)({\n            projectId,\n          })\n\n          // Open WalletConnectModal\n          walletConnectModal.openModal({\n            uri,\n            onClose,\n          })\n\n          // Subscribe to modal state changes\n          const unsubscribeModal = walletConnectModal.subscribeModal(\n            (state: {open: boolean}) => {\n              if (state.open === false) {\n                onClose?.()\n                unsubscribeModal()\n              }\n            }\n          )\n        } else {\n          pairingModalOverride(uri, onClose)\n        }\n      }\n\n      const session = await Promise.race([\n        approval(),\n        new Promise<never>((_, reject) => {\n          if (abortSignal?.aborted) {\n            reject(new Error(\"Session request aborted\"))\n          }\n          abortSignal?.addEventListener(\"abort\", () => {\n            reject(new Error(\"Session request aborted\"))\n          })\n        }),\n      ])\n\n      if (session == null) {\n        throw new Error(\"Session request failed\")\n      }\n\n      return session\n    } catch (error) {\n      if (error instanceof Error) {\n        log({\n          title: `${error.name} Error establishing WalletConnect session`,\n          message: `\n          ${error.message}\n          uri: ${_uri}\n        `,\n          level: LEVELS.error,\n        })\n      }\n      onClose()\n      throw error\n    } finally {\n      walletConnectModal?.closeModal()\n    }\n  }\n}\n\n/**\n * Show a notification for a WalletConnect request.\n * @param service - The service that is requesting the user's attention.\n * @param user - The user that is being requested to sign a transaction.\n * @returns A close function to dismiss the notification.\n */\nexport function showWcRequestNotification({\n  service,\n  user,\n}: {\n  service: Service\n  user: CurrentUser\n}) {\n  const authnService = user?.services?.find((s: any) => s.type === \"authn\")\n  const walletProvider = authnService?.provider || service.provider\n\n  return showNotification({\n    title: walletProvider?.name || \"Mobile Wallet\",\n    message: isMobile()\n      ? \"Tap to view request in app\"\n      : \"Pending request on your mobile device\",\n    icon: walletProvider?.icon || mobileIcon,\n    onClick:\n      isMobile() && service.uid ? () => openDeeplink(service.uid!) : undefined,\n    debounceDelay: service.type === \"pre-authz\" ? 500 : 0,\n  })\n}\n\nasync function resolveProvider({\n  provider,\n  externalProviderOrTopic,\n}: {\n  provider: Promise<InstanceType<typeof UniversalProvider> | null>\n  externalProviderOrTopic?: string | InstanceType<typeof UniversalProvider>\n}): Promise<{\n  provider: InstanceType<typeof UniversalProvider>\n  isExternal: boolean\n} | null> {\n  if (!externalProviderOrTopic) {\n    const resolved = await provider\n    return resolved ? {provider: resolved, isExternal: false} : null\n  }\n\n  // If it's a UniversalProvider instance, use it directly and store it.\n  if (typeof externalProviderOrTopic !== \"string\") {\n    const topic = externalProviderOrTopic.session?.topic\n    if (!topic) {\n      throw new Error(\n        \"Cannot resolve provider: UniversalProvider is not initialized\"\n      )\n    }\n    providerStore.setState({\n      [topic]: externalProviderOrTopic,\n    })\n    return {provider: externalProviderOrTopic, isExternal: true}\n  }\n\n  const externalTopic = externalProviderOrTopic\n  if (externalTopic) {\n    // Check if an external provider was passed in the options.\n    let storedProvider = providerStore.getState()[externalTopic]\n    if (!storedProvider) {\n      // No provider from opts and nothing in store yetâ€”wait for it.\n      let unsubStore: () => void\n      let timeout: NodeJS.Timeout\n\n      storedProvider = await new Promise<any>((resolve, reject) => {\n        unsubStore = providerStore.subscribe(() => {\n          const provider = providerStore.getState()[externalTopic]\n          if (provider) {\n            resolve(provider)\n          }\n        })\n\n        // If the provider is not defined after 5 seconds, reject the promise.\n        timeout = setTimeout(() => {\n          reject(\n            new Error(\n              `Provider for external topic ${externalTopic} not found after 5 seconds`\n            )\n          )\n        }, 5000)\n      }).finally(() => {\n        clearTimeout(timeout)\n        unsubStore()\n      })\n    }\n\n    return {provider: storedProvider, isExternal: true}\n  }\n\n  const resolved = await provider\n  return resolved ? {provider: resolved, isExternal: false} : null\n}\n","import * as fclCore from \"@onflow/fcl-core\"\nimport {invariant} from \"@onflow/util-invariant\"\nimport {LEVELS, log} from \"@onflow/util-logger\"\nexport {getSdkError} from \"@walletconnect/utils\"\nimport {makeServicePlugin} from \"./service\"\nimport {CoreTypes} from \"@walletconnect/types\"\nimport {\n  UniversalProvider,\n  UniversalProviderOpts,\n} from \"@walletconnect/universal-provider\"\n\nexport interface FclWalletConnectConfig {\n  projectId: string\n  metadata?: CoreTypes.Metadata\n  includeBaseWC?: boolean\n  wcRequestHook?: any\n  pairingModalOverride?: any\n  wallets?: any[]\n  disableNotifications?: boolean\n}\n\nconst DEFAULT_RELAY_URL = \"wss://relay.walletconnect.com\"\nconst DEFAULT_LOGGER = \"debug\"\nlet providerPromise: Promise<InstanceType<typeof UniversalProvider> | null> =\n  Promise.resolve(null)\n\nconst initClient = async ({\n  projectId,\n  metadata,\n}: {\n  projectId: string\n  metadata?: CoreTypes.Metadata\n}) => {\n  invariant(\n    projectId != null,\n    \"FCL Wallet Connect Error: WalletConnect projectId is required\"\n  )\n  try {\n    return UniversalProvider.init({\n      logger: DEFAULT_LOGGER,\n      relayUrl: DEFAULT_RELAY_URL,\n      projectId: projectId,\n      metadata: metadata,\n    })\n  } catch (error) {\n    if (error instanceof Error) {\n      log({\n        title: `${error.name} fcl-wc Init Client`,\n        message: error.message,\n        level: LEVELS.error,\n      })\n    }\n    throw error\n  }\n}\n\nconst initUniversalProvider = async (opts: UniversalProviderOpts) => {\n  return UniversalProvider.init({})\n}\n\nexport const initLazy = (config: FclWalletConnectConfig) => {\n  const {FclWcServicePlugin, providerPromise} = initHelper(config)\n  fclCore.discovery.authn.update()\n\n  return {\n    FclWcServicePlugin,\n    providerPromise,\n  }\n}\n\nexport const init = async (config: FclWalletConnectConfig) => {\n  const {FclWcServicePlugin, providerPromise} = initLazy(config)\n  const client = await providerPromise\n  fclCore.discovery.authn.update()\n\n  return {\n    FclWcServicePlugin,\n    client,\n  }\n}\n\nconst initHelper = (config: FclWalletConnectConfig) => {\n  if (typeof window === \"undefined\") {\n    throw new Error(\n      \"FCL Wallet Connect Plugin can only be initialized in the browser\"\n    )\n  }\n\n  // Lazy load the SignClient\n  //  - Initialize the client if it doesn't exist\n  //  - If it does exist, return existing client\n  //  - If existing client fails to initialize, reinitialize\n  providerPromise = providerPromise\n    .catch(() => null)\n    .then(_client => {\n      if (_client) {\n        return _client\n      } else {\n        return initClient({\n          projectId: config.projectId,\n          metadata: config.metadata,\n        })\n      }\n    })\n    .catch(e => {\n      log({\n        title: `WalletConnect Client Initialization Error`,\n        message: e.message ? e.message : e,\n        level: LEVELS.error,\n      })\n      throw e\n    })\n\n  const FclWcServicePlugin = makeServicePlugin(providerPromise, config)\n\n  return {\n    FclWcServicePlugin,\n    providerPromise,\n  }\n}\n\n// Returns the SignClient instance used by this plugin if it has been initialized\nexport async function getProvider() {\n  return providerPromise.then(provider => {\n    if (!provider) {\n      throw new Error(\"WalletConnect client not initialized\")\n    }\n\n    return provider\n  })\n}\n\nexport {SERVICE_PLUGIN_NAME} from \"./constants\"\n"],"names":["FLOW_METHODS","REQUEST_TYPES","SERVICE_PLUGIN_NAME","WC_SERVICE_METHOD","PRE_AUTHZ_SERVICE_TYPE","isAndroid","navigator","test","userAgent","isSmallIOS","isLargeIOS","isIOS","isMobile","openDeeplink","url","startsWith","link","document","createElement","href","target","rel","click","window","open","shouldDeepLink","_ref","service","user","endpoint","FLOW_AUTHN","FLOW_AUTHZ","services","find","s","method","type","preloadImage","img","Image","src","createSessionProposal","provider","existingPairing","network","_network","fclCore","getChainId","requiredNamespaces","flow","methods","FLOW_PRE_AUTHZ","FLOW_USER_SIGN","chains","events","cleanup","uri","Promise","resolve","reject","onDisplayUri","on","removeListener","Error","sessionPromise","connect","pairingTopic","topic","namespaces","finally","approval","request","_ref2","body","session","isExternal","abortSignal","disableNotifications","chainId","addr","address","makeSessionData","data","JSON","stringify","result","race","client","params","_","aborted","addEventListener","status","addSessionInfo","externalProvider","map","proposer","payer","authorization","reason","namespace","reference","Object","values","accounts","flat","filter","account","split","Notification","title","message","icon","onClick","onDismiss","animate","_jsxs","className","role","e","stopPropagation","children","_jsx","alt","xmlns","viewBox","fill","fillRule","d","renderRoot","id","dismissTimeout","createRenderRoot","shadowHost","shadowRoot","attachShadow","mode","container","appendChild","style","textContent","styles","mediaQuery","matchMedia","listener","classList","toggle","matches","showNotification","debounceDelay","clearTimeout","render","dismissUi","dismiss","setTimeout","createStore","initialState","subscribers","Set","state","subscribe","subscriber","add","delete","setState","newState","forEach","getState","providerStore","makeServicePlugin","config","arguments","length","undefined","projectId","name","f_type","serviceStrategy","exec","makeExec","then","m","WalletConnectModal","signerPromise","opts","wcRequestHook","pairingModalOverride","_appDisabledNotifications","appDisabledNotifications","resolvedProvider","resolveProvider","externalProviderOrTopic","invariant","pairing","appLink","validateAppLink","onClose","connectWc","Function","SIGNING_REQUEST","walletDisabledNotifications","sessionProperties","notification","showWcRequestNotification","uid","log","level","LEVELS","warn","_ref3","providerOpts","_uri","walletConnectModal","SESSION_REQUEST","queryString","URLSearchParams","toString","openModal","unsubscribeModal","subscribeModal","error","closeModal","_ref4","authnService","walletProvider","mobileIcon","_ref5","resolved","externalTopic","storedProvider","unsubStore","timeout","DEFAULT_RELAY_URL","DEFAULT_LOGGER","providerPromise","initClient","metadata","UniversalProvider","init","logger","relayUrl","initLazy","FclWcServicePlugin","initHelper","discovery","authn","update","catch","_client","getProvider"],"mappings":"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"}