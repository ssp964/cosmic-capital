<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperlane CLI Web Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-lg">
        <h1 class="text-3xl font-bold mb-6 text-center">Hyperlane CLI Web Tool</h1>
        
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Connect Wallet</h2>
            <button id="connect-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300">
                Connect MetaMask
            </button>
            <p id="wallet-address" class="mt-2 text-sm text-center text-gray-400 hidden"></p>
        </div>

        <hr class="border-gray-600 mb-6">

        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Deploy & Send Tokens</h2>
            <input id="config-path" type="text" placeholder="Path to warp config YAML file" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-sm mb-3">
            <input id="recipient" type="text" placeholder="Recipient address" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-sm mb-3">
            <input id="amount" type="number" step="any" placeholder="Amount" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-sm mb-3">
            <button id="deploy-send-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700 transition duration-300">
                Deploy & Send
            </button>
        </div>

        <div>
            <h2 class="text-xl font-semibold mb-4">Output</h2>
            <pre id="output" class="bg-gray-700 p-4 rounded-lg text-sm overflow-auto max-h-64"></pre>
        </div>
    </div>

    <script>
      const outputEl = document.getElementById('output');
      const connectBtn = document.getElementById('connect-btn');
      const walletAddressEl = document.getElementById('wallet-address');
      const recipientInput = document.getElementById('recipient');

      async function connectWallet() {
        if (window.ethereum) {
          try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            const address = accounts[0];
            walletAddressEl.textContent = 'Connected: ' + address;
            walletAddressEl.classList.remove('hidden');
            recipientInput.value = address;
            outputEl.textContent = 'Wallet connected successfully!';
          } catch (error) {
            console.error('Wallet connection failed:', error);
            outputEl.textContent = 'Wallet connection failed.';
          }
        } else {
          outputEl.textContent = 'MetaMask not detected. Please install it.';
        }
      }

      async function deployAndSend() {
        const configPath = document.getElementById('config-path').value;
        const recipient = document.getElementById('recipient').value;
        const amount = document.getElementById('amount').value;

        // Hardcoded parameters (you can replace if you want them to be dynamic later)
        const data = {
          configPath,
          from: 'basesepolia',
          to: 'optimismsepolia',
          tokenAddress: '0x4200000000000000000000000000000000000006',
          recipient,
          amount
        };

        outputEl.textContent = 'Running deployment and send...';

        try {
          const response = await fetch('http://localhost:3000/deploy-and-send', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const result = await response.json();
          if (response.ok) {
            outputEl.textContent = '✅ Completed successfully:\n\n' + result.output;
          } else {
            outputEl.textContent = '❌ Error:\n\n' + (result.output || result.error);
          }
        } catch (error) {
          console.error('Fetch error:', error);
          outputEl.textContent = 'Failed to connect to the local server. Is it running?';
        }
      }

      connectBtn.addEventListener('click', connectWallet);
      document.getElementById('deploy-send-btn').addEventListener('click', deployAndSend);
    </script>
</body>
</html>
